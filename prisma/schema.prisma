// This is your Prisma schema file
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Donations {
  id              String  @id @default(uuid()) @map("_id")
  name            String
  email           String
  phoneNumber     String
  isPhoneWhatsapp Boolean
  gender          String
  birth           String

  state      String
  city       String
  street     String
  homeNumber String
  complement String?
  district   String
  zipCode    String

  cpf  String
  rg   String?
  cnpj String?
  ufrg String

  valuePaid     Float
  paymentMethod String
  paymentStatus String
  paymentDate   DateTime?

  donationExpirationDate DateTime?

  ciclesBought Int
  ciclePaid    Int
  valueBought  Float

  stripeSubscriptionID String?

  canceledAt DateTime?

  stripeCustomerID String
  createdAt        DateTime @default(now())

  txid                   String? @unique
  pixCopiaECola          String? @unique
  pixQrCode              String? @unique
  pixStatus              String?
  pixValor               String?
  pixDate                String?
  pixExpiracaoEmSegundos Int?

  @@map("Donations")
}

model Students {
  id              String  @id @default(uuid()) @map("_id")
  name            String
  email           String
  gender          String
  birth           String
  phoneNumber     String
  isPhoneWhatsapp Boolean
  state           String
  city            String
  street          String
  homeNumber      String
  complement      String?
  district        String
  zipCode         String

  cpf                      String @unique
  rg                       String?
  ufrg                     String
  selfDeclaration          String
  oldSchool                String?
  oldSchoolAdress          String?
  highSchoolGraduationDate String
  highSchoolPeriod         String
  metUsMethod              String
  exStudent                String
  stripeCustomerID         String

  emailResponsavel     String? // Opcional, para o e-mail do responsável
  aceiteTermoCiencia   Boolean // Obrigatório para o aceite
  aceiteTermoInscricao Boolean // Obrigatório para o aceite

  purcharsedSubscriptions PurchasedSubscriptions[]
  createdAt               DateTime                 @default(now())

  @@map("Students")
}

model DiscountCoupon {
  id            String   @id @default(uuid()) @map("_id")
  code          String   @unique // O código do cupom (ex: "PROMO10")
  discountValue Float // O valor em BRL (ex: 5.00 para R$5,00)
  isActive      Boolean  @default(true) // Para ativar/desativar
  maxUses       Int? // Opcional: número máximo de usos
  currentUses   Int      @default(0) // Quantas vezes foi usado
  createdAt     DateTime @default(now())

  @@map("DiscountCoupons")
}

model Admins {
  id            String        @id @default(uuid()) @map("_id")
  name          String
  email         String        @unique
  username      String        @unique
  password      String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now())
  refresh_token RefreshToken?

  @@map("Admins")
}

model RefreshToken {
  id         String @id @default(uuid()) @map("_id")
  expires_at Int
  admin      Admins @relation(fields: [adminID], references: [id])
  adminID    String @unique

  @@map("refresh_token")
}

model SchoolClass {
  id    String @id @default(uuid()) @map("_id")
  title String

  code                String? // Cód da turma (ex: "TSA")
  registrationCounter Int     @default(0) // Contador sequencial

  informations    SchoolClassInformations
  subscriptions   SchoolClassSubscriptionInformations
  selectiveStages SchoolClassSelectiveStages[]
  status          String // Changed from Boolean to String
  stripeProductID String
  documents       DocumentsTypes[]
  registrations   Registrations

  @@map("SchoolClass")
}

type PurchasedSubscriptions {
  schoolClassID        String
  stripeSubscriptionID String?
  productID            String?
  productName          String?
  paymentMethod        String
  paymentStatus        String
  paymentDate          DateTime
  valuePaid            Float

  matriculaID String? // NOVO: Para guardar o ID (2026TSA0001)

  txid                   String?
  pixCopiaECola          String?
  pixQrCode              String?
  pixStatus              String?
  pixValor               String?
  pixDate                String?
  pixExpiracaoEmSegundos Int?
  codigoDesconto         String? // Para salvar qual cupom foi usado
}

type DocumentsTypes {
  docsID       String
  title        String
  downloadLink String
}

type SchoolClassInformations {
  description       String
  whoCanParticipate String
  observations      String?
  classContent      String
  dateSchedule      String
  hourSchedule      String
  color             String
}

type SchoolClassSubscriptionInformations {
  status               String
  price                Int
  subscriptionSchedule String
}

type SchoolClassSelectiveStages {
  stagesID    String
  when        String
  resultsDate DateTime?
  description String
}

type Registrations {
  description String
  value       Int
}
